# 开发者指南

<cite>
**本文档中引用的文件**
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [CONTRIBUTING_CN.md](file://CONTRIBUTING_CN.md)
- [README.md](file://README.md)
- [README_CN.md](file://README_CN.md)
- [api/README.md](file://api/README.md)
- [web/README.md](file://web/README.md)
- [api/pyproject.toml](file://api/pyproject.toml)
- [api/pytest.ini](file://api/pytest.ini)
- [api/ty.toml](file://api/ty.toml)
- [docker/docker-compose.yaml](file://docker/docker-compose.yaml)
- [docker/docker-compose.middleware.yaml](file://docker/docker-compose.middleware.yaml)
- [docker/docker-compose-template.yaml](file://docker/docker-compose-template.yaml)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [开发环境搭建](#开发环境搭建)
4. [代码风格与提交规范](#代码风格与提交规范)
5. [测试策略](#测试策略)
6. [调试与性能分析](#调试与性能分析)
7. [贡献流程](#贡献流程)
8. [常见问题与故障排除](#常见问题与故障排除)
9. [附录](#附录)

## 简介
Dify 是一个开源的 LLM 应用开发平台，提供直观的界面来构建和管理 AI 工作流、RAG 管道、智能体功能、模型管理以及可观测性功能。本指南旨在为贡献者提供完整的开发环境配置、代码贡献规范和调试指导，帮助开发者快速上手并高效参与项目开发。

**Section sources**
- [README.md](file://README.md#L0-L207)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L0-L97)

## 项目结构
Dify 项目采用前后端分离的架构，主要由 `api`（后端服务）、`web`（前端应用）、`docker`（容器化部署配置）、`sdks`（客户端 SDK）等核心目录组成。后端基于 Python Flask 框架，前端基于 React 技术栈，通过 Docker Compose 实现本地开发和部署。

```mermaid
graph TB
subgraph "核心模块"
API[api/]
Web[web/]
Docker[docker/]
SDKs[sdks/]
end
subgraph "后端服务"
API --> Configs[configs/]
API --> Controllers[controllers/]
API --> Core[core/]
API --> Models[models/]
API --> Services[services/]
API --> Tasks[tasks/]
end
subgraph "前端应用"
Web --> App[app/]
Web --> Components[components/]
Web --> Service[service/]
Web --> Utils[utils/]
Web --> I18n[i18n/]
end
subgraph "部署配置"
Docker --> Compose[docker-compose.yaml]
Docker --> Env[.env.example]
Docker --> Certbot[certbot/]
Docker --> Nginx[nginx/]
end
API < --> Web
Docker --> API
Docker --> Web
```

**Diagram sources**
- [README.md](file://README.md#L0-L207)
- [api/README.md](file://api/README.md)
- [web/README.md](file://web/README.md)

**Section sources**
- [README.md](file://README.md#L0-L207)

## 开发环境搭建
### 依赖安装
本地开发环境依赖 Docker 和 Docker Compose。首先克隆项目仓库，然后进入 `docker` 目录，复制示例环境文件并启动服务：

```bash
cd dify
cd docker
cp .env.example .env
docker compose up -d
```

服务启动后，可通过 `http://localhost/install` 访问 Dify 安装向导完成初始化。

### 服务启动
项目提供完整的 Docker Compose 配置文件，包括 `docker-compose.yaml`（主配置）、`docker-compose.middleware.yaml`（中间件配置）和 `docker-compose-template.yaml`（模板配置）。开发者可根据需要自定义配置，如修改端口映射、卷挂载或镜像版本。

### 调试工具设置
后端服务日志可通过 `docker-compose logs` 命令查看，前端开发支持热重载。对于深度调试，建议使用 IDE 的远程调试功能连接容器内的 Python 和 Node.js 进程。

**Section sources**
- [README.md](file://README.md#L100-L150)
- [docker/docker-compose.yaml](file://docker/docker-compose.yaml)
- [docker/docker-compose.middleware.yaml](file://docker/docker-compose.middleware.yaml)
- [docker/docker-compose-template.yaml](file://docker/docker-compose-template.yaml)

## 代码风格与提交规范
### 代码风格
后端 Python 代码遵循 PEP 8 规范，使用 `pyproject.toml` 中定义的工具链进行格式化和静态检查。前端 TypeScript 代码采用 ESLint 和 Prettier 进行代码质量控制，配置位于 `web/eslint.config.mjs` 和 `web/.prettierrc`。

### 提交规范
所有代码提交必须遵循以下流程：
1. Fork 仓库并创建新分支
2. 在提交 PR 前先创建 issue 讨论变更
3. 为变更添加相应的测试
4. 确保代码通过所有现有测试
5. 在 PR 描述中关联相关 issue，格式为 `fixes #<issue编号>`
6. 等待代码审查和合并

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L50-L97)
- [api/pyproject.toml](file://api/pyproject.toml)
- [web/eslint.config.mjs](file://web/eslint.config.mjs)

## 测试策略
### 单元测试
后端单元测试位于 `api/tests/unit_tests` 目录，使用 pytest 框架。测试配置在 `api/pytest.ini` 中定义。前端单元测试位于 `web/__tests__` 目录，使用 Jest 框架。

### 集成测试
集成测试位于 `api/tests/integration_tests` 目录，测试服务间的交互。使用 Testcontainers 进行外部依赖的集成测试，确保测试环境的一致性。

### 端到端测试
端到端测试模拟真实用户场景，验证整个应用的工作流。前端 E2E 测试使用 Playwright 或 Cypress 等工具，后端 E2E 测试通过 API 调用验证核心功能。

**Section sources**
- [api/pytest.ini](file://api/pytest.ini)
- [api/tests/unit_tests](file://api/tests/unit_tests)
- [api/tests/integration_tests](file://api/tests/integration_tests)

## 调试与性能分析
### 调试技巧
- 使用 `docker-compose logs` 查看服务日志
- 在代码中添加详细的日志输出，使用 Python 的 logging 模块
- 利用 IDE 的断点调试功能进行逐步排查
- 使用 `dev/pytest` 目录下的脚本运行特定测试用例

### 性能分析工具
- 后端性能分析可使用 Python 的 cProfile 或 Py-Spy
- 前端性能分析使用 Chrome DevTools 的 Performance 面板
- 系统级性能监控通过 Prometheus 和 Grafana 实现（配置在 docker 目录中）
- 分布式追踪通过 OpenTelemetry 集成，配置在 `api/configs/observability/otel` 中

**Section sources**
- [dev/pytest](file://dev/pytest)
- [api/configs/observability/otel](file://api/configs/observability/otel)

## 贡献流程
### 问题报告
提交 bug 报告时请包含：
- 清晰的标题
- 详细的 bug 描述和错误信息
- 可复现的步骤
- 预期行为
- 相关日志（docker-compose 日志）
- 截图或视频

### 功能请求
提交功能请求时请包含：
- 清晰的标题
- 详细的功能描述
- 使用场景
- 相关上下文或截图

### PR 提交流程
1. Fork 仓库
2. 创建新分支
3. 实现功能或修复 bug
4. 添加测试
5. 提交 PR 并关联 issue
6. 参与代码审查
7. 等待合并

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L20-L97)
- [CONTRIBUTING_CN.md](file://CONTRIBUTING_CN.md#L20-L97)

## 常见问题与故障排除
### 环境配置问题
- 确保 Docker 和 Docker Compose 已正确安装
- 检查 `.env` 文件配置是否正确
- 确认端口未被其他进程占用

### 服务启动问题
- 查看 `docker-compose logs` 获取详细错误信息
- 检查数据库迁移是否成功
- 验证外部依赖服务（如 Redis、PostgreSQL）是否正常运行

### 依赖安装问题
- 确保网络连接正常，能访问 PyPI 和 npm 仓库
- 检查 Python 和 Node.js 版本是否符合要求
- 清理包管理器缓存后重试

**Section sources**
- [README.md](file://README.md#L150-L200)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L20-L30)

## 附录
### 相关资源
- [Dify 文档](https://docs.dify.ai)
- [Dify Cloud](https://cloud.dify.ai)
- [社区讨论](https://github.com/langgenius/dify/discussions)
- [Discord 社区](https://discord.gg/8Tpq4AcN9c)

### 多语言支持
项目提供多语言文档，包括：
- [English](file://README.md)
- [简体中文](file://README_CN.md)
- [繁體中文](file://README_TW.md)
- [日本語](file://README_JA.md)
- [Español](file://README_ES.md)

**Section sources**
- [README.md](file://README.md#L200-L207)
- [README_CN.md](file://README_CN.md)
- [README_TW.md](file://README_TW.md)